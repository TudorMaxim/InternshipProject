<% provide(:title, @user.full_name) %>
<div class="row">
  <aside class="col-md-4">
    <section class="user_info">
      <h1>
        <%= gravatar_for @user %>
        <%= @user.full_name %>
      </h1>
    </section>
  </aside>

  <aside class="col-md-4"> </aside>

  <aside class="col-md-4">
    <section class="user_info", style="float:right">
      <h1> Status: <%= current_user.victories %> <%= "victory".pluralize(current_user.victories) %> </h1>
    </section>
  </aside>
</div>

<% if @user != current_user && !current_user.friend_with?(@user) %>
  <%= link_to "Add Friend", friendships_path(:friend_id => @user), :method => :post, class: "btn btn-primary" %>
<% elsif @user != current_user && current_user.friend_with?(@user) %>
  <%= link_to "Unfriend", current_user.find_any_friendship_with(@user), :method => :delete, class: "btn btn-danger" %>
<% end %>

<h1>History</h1>
<div class="table-responsive">
  <table class="table" border="0">
    <% @user.played_games.each do |game| %>
      <% if game.winner_id == @user.id %>

        <tr class="success">
          <td id="winner" class="center"><h4>WIN<h4></td>
          <td class="left">
              <%= gravatar_for @user, size: 50 %>
              <%= @user.full_name %>
          </td>
          <td class="center">VS</td>
          <td class="left">
            <% enemy_id = @user.id == game.sender_id ? game.receiver_id : game.sender_id %>
            <% enemy = User.find_by(id: enemy_id) %>
            <div style="float:right">
              <%= gravatar_for enemy, size: 50 %>
            </div>
            <div style="float:right">
              <%= enemy.full_name %>
            </div>
          </td>
        </tr>

      <% elsif game.winner_id.nil? %>

        <tr class="warning">
          <td id="draw" class="center"><h4>DRAW<h4></td>
          <td class="left">
              <%= gravatar_for @user, size: 50 %>
              <%= @user.full_name %>
          </td>
          <td class="center">VS</td>
          <td class="left">
            <% enemy_id = @user.id == game.sender_id ? game.receiver_id : game.sender_id %>
            <% enemy = User.find_by(id: enemy_id) %>
            <div style="float:right">
              <%= gravatar_for enemy, size: 50 %>
            </div>
            <div style="float:right">
              <%= enemy.full_name %>
            </div>
          </td>
        </tr>

      <% else %>
        <tr class="danger">
          <td id="loser" class="center"><h4>LOSE<h4></td>
          <td class="left">
              <%= gravatar_for @user, size: 50 %>
              <%= @user.full_name %>
          </td>
          <td class="center">VS</td>
          <td class="left">
            <% enemy_id = @user.id == game.sender_id ? game.receiver_id : game.sender_id %>
            <% enemy = User.find_by(id: enemy_id) %>
            <div style="float:right">
              <%= gravatar_for enemy, size: 50 %>
            </div>
            <div style="float:right">
              <%= enemy.full_name %>
            </div>
          </td>
        </tr>
      <% end %>
    <% end %>
  </table>
</div>
